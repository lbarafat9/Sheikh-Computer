<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheikh Computer</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;font-family:'Hind Siliguri',sans-serif}
        body{margin:0;background:#f0f2f5}
        .en{font-family:Arial}
        header{background:#4CAF50;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold;display:none;position:fixed;top:0;width:100%;z-index:100}
        #loginDiv{max-width:400px;margin:120px auto;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.1);text-align:center}
        #container{display:none;padding:20px;padding-top:80px;max-width:1200px;margin:auto}
        input,select,button{width:100%;padding:10px;margin-top:10px;border-radius:6px;border:1px solid #ccc;outline:none}
        button{background:#4CAF50;color:#fff;font-weight:bold;border:none;cursor:pointer}
        button:hover{opacity:0.9}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
        .card{background:#fff;padding:20px;border-radius:10px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.05);border-bottom:3px solid #4CAF50}
        #menuBtn{position:fixed;top:15px;left:15px;font-size:26px;color:#fff;cursor:pointer;display:none;z-index:150}
        #sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#2c3e50;color:#fff;transition:.3s;z-index:200;padding-top:20px}
        #sidebar a{display:block;color:#ecf0f1;text-decoration:none;padding:15px 25px;border-bottom:1px solid #34495e;cursor:pointer}
        #overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;z-index:150}
        .section{display:none}
        .table-box{background:#fff;border-radius:10px;overflow-x:auto;box-shadow:0 2px 5px rgba(0,0,0,.05)}
        table{width:100%;border-collapse:collapse;min-width:800px}
        th,td{padding:12px;border-bottom:1px solid #eee;text-align:left}
        th{background:#f8f9fa}
        .btn-del{background:#ff4757;padding:5px 10px;width:auto;margin:0;font-size:12px}
        @media print{header,#menuBtn,#sidebar,#overlay,#loginDiv,.noPrint{display:none!important}#container{padding:0}}
    </style>
</head>
<body>

<header id="header">‡¶∂‡ßá‡¶ñ ‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</header>
<div id="menuBtn" onclick="openSidebar()">‚ò∞</div>
<div id="overlay" onclick="closeSidebar()"></div>

<div id="loginDiv">
    <h2>‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <input id="uName" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
    <input id="uPass" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<div id="container">
    <div id="sidebar">
        <div style="text-align:right;padding:10px;font-size:28px;cursor:pointer" onclick="closeSidebar()">√ó</div>
        <div style="text-align:center;padding-bottom:10px;font-weight:bold" id="userShow"></div>
        <hr style="border:0;border-top:1px solid #34495e">
        <a onclick="showSection('dashboard')">üè† ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a>
        <a onclick="showSection('newEntry')">üìù ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</a>
        <a onclick="showSection('oldEntry')">üìÑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü / ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</a>
        <a onclick="logout()" style="color:#ff7675">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a>
    </div>

    <div id="dashboard" class="section">
        <div class="stats en">
            <div class="card">‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø<br><b id="cCount">0</b></div>
            <div class="card">‡¶Æ‡ßã‡¶ü (‡ß≥)<br><b id="cTotal">0</b></div>
            <div class="card">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ (‡ß≥)<br><b id="cTaken">0</b></div>
            <div class="card">‡¶≤‡¶∏ (‡ß≥)<br><b id="cLoss">0</b></div>
        </div>
        <div class="table-box">
            <table>
                <thead>
                    <tr><th>‡¶∏‡¶Æ‡ßü/‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ï‡¶æ‡¶ú</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Æ‡ßã‡¶ü</th><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂</th><th>‡¶≤‡¶∏</th><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th class="noPrint">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</th></tr>
                </thead>
                <tbody id="tableBody" class="en"></tbody>
            </table>
        </div>
    </div>

    <div id="newEntry" class="section">
        <div class="noPrint" style="max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:10px">
            <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            
            <div style="display:flex; gap:5px; align-items:center;">
                <select id="category" onchange="catChange()" style="flex:1"></select>
                <button onclick="deleteCategory()" title="‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®" class="btn-del noPrint" style="padding:10px; margin-top:10px;">üóëÔ∏è</button>
            </div>

            <div style="display:flex; gap:5px; align-items:center;">
                <select id="work" disabled onchange="workChange()" style="flex:1"></select>
                <button onclick="deleteWork()" title="‡¶ï‡¶æ‡¶ú ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®" class="btn-del noPrint" style="padding:10px; margin-top:10px;">üóëÔ∏è</button>
            </div>

            <input id="qty" type="number" value="1" class="en" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" oninput="calc()">
            <input id="rate" type="number" class="en" placeholder="‡¶¶‡¶∞" oninput="calc()">
            <input id="total" readonly class="en" placeholder="‡¶Æ‡ßã‡¶ü" style="background:#eee">
            <input id="taken" type="number" class="en" placeholder="‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂" oninput="calc()">
            <input id="loss" readonly class="en" placeholder="‡¶≤‡¶∏" style="background:#eee">
            <input id="note" placeholder="‡¶®‡ßã‡¶ü (‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ)">
            <button onclick="saveEntry()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="oldEntry" class="section">
        <div class="noPrint" style="margin-bottom:20px;display:flex;gap:10px">
            <input type="date" id="sDate" class="en" style="margin:0">
            <button onclick="searchByDate()" style="margin:0">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</button>
            <button onclick="loadEntries()" style="margin:0;background:#95a5a6">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
            <button onclick="downloadExcel()" style="margin:0;background:#3498db">Excel</button>
            <button onclick="window.print()" style="margin:0;background:#2ecc71">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
    apiKey:"AIzaSyCvNH_VOQm3_FYKQocEVlFN1DTYMy-BPlM",
    authDomain:"sheikh-computer-b41d5.firebaseapp.com",
    databaseURL:"https://sheikh-computer-b41d5-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId:"sheikh-computer-b41d5"
});
const db=firebase.database();
let user="", rates={};

window.onload = function() {
    const savedUser = localStorage.getItem("loggedInUser");
    if(savedUser) { setupUser(savedUser); }
};

function login(){
    const u=uName.value, p=uPass.value;
    const users={admin:"123",owner:"456",roky:"789"};
    if(users[u]===p){
        localStorage.setItem("loggedInUser", u);
        setupUser(u);
    } else alert("‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø");
}

function setupUser(u) {
    user = u;
    loginDiv.style.display="none"; container.style.display="block";
    header.style.display="block"; menuBtn.style.display="block";
    userShow.innerText="üë§ "+u.toUpperCase();
    loadRates(); loadEntries(); showSection('dashboard');
}

function logout() {
    if(confirm("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
        localStorage.removeItem("loggedInUser");
        location.reload();
    }
}

function openSidebar(){sidebar.style.left="0";overlay.style.display="block"}
function closeSidebar(){sidebar.style.left="-260px";overlay.style.display="none"}
function showSection(id){
    document.querySelectorAll('.section').forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block"; closeSidebar();
}

function loadRates(){
    db.ref("rates").on("value", s => {
        const defaultRates = {
            "Print": {"A4 ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü": 10, "‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞": 30},
            "Typing": {"‡¶Ü‡¶¨‡ßá‡¶¶‡¶®": 100, "‡¶°‡¶ø‡¶°": 300},
            "Online": {"NID": 100, "‡¶≠‡¶∞‡ßç‡¶§‡¶ø": 150},
            "Photocopy": {"‡¶ï‡¶™‡¶ø": 5},
            "Laminating": {"‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£": 20}
        };
        const dbData = s.val() || {};
        rates = { ...defaultRates, ...dbData };
        
        category.innerHTML = "<option value=''>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>";
        Object.keys(rates).forEach(c => category.innerHTML += `<option>${c}</option>`);
        category.innerHTML += `<option value="add">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>`;
    });
}

function catChange(){
    if(category.value==="add"){
        const c=prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶æ‡¶Æ:");
        if(c) db.ref("rates/"+c).set({"‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú":0});
        return;
    }
    const cat = category.value;
    work.innerHTML="<option value=''>‡¶ï‡¶æ‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>";
    if(cat && rates[cat]){
        Object.keys(rates[cat]).forEach(w=>work.innerHTML+=`<option>${w}</option>`);
        work.innerHTML+=`<option value="add">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú</option>`;
        work.disabled=false;
    } else { work.disabled=true; }
}

function workChange(){
    if(work.value==="add"){
        const w=prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:"), r=prompt("‡¶¶‡¶∞ (Rate):");
        if(w) db.ref(`rates/${category.value}/${w}`).set(+r||0);
        return;
    }
    rate.value=rates[category.value][work.value]||0;
    calc();
}

function deleteCategory(){
    const cat = category.value;
    if(!cat || cat==="add") return alert("‡¶Ü‡¶ó‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®");
    if(confirm(`${cat} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?`)){
        db.ref("rates/"+cat).remove();
        category.value=""; catChange();
    }
}

function deleteWork(){
    const cat = category.value;
    const wrk = work.value;
    if(!wrk || wrk==="add") return alert("‡¶Ü‡¶ó‡ßá ‡¶ï‡¶æ‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®");
    if(confirm(`${wrk} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?`)){
        db.ref(`rates/${cat}/${wrk}`).remove();
        work.value="";
    }
}

function calc(){
    total.value = qty.value * (rate.value || 0);
    loss.value = total.value - (taken.value || 0);
}

function saveEntry(){
    if(!work.value || work.value==="add") return alert("‡¶ï‡¶æ‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®");
    const d=new Date();
    db.ref("entries").push({
        date: d.toLocaleDateString("en-GB"),
        time: d.toLocaleTimeString("en-US",{hour:'2-digit',minute:'2-digit'}),
        work: work.value, qty: qty.value, rate: rate.value, total: total.value,
        taken: taken.value||0, loss: loss.value||0,
        user: user, note: note.value
    }).then(()=>{
        alert("‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        taken.value=""; note.value="";
        showSection('dashboard');
    });
}

function loadEntries(){
    db.ref("entries").on("value",s=>renderTable(s.val()));
}

function renderTable(data){
    let c=0,t=0,k=0,l=0;
    tableBody.innerHTML="";
    if(!data) return;
    Object.keys(data).reverse().forEach(key=>{
        const e = data[key];
        c++; t+=+e.total; k+=+e.taken; l+=+e.loss;
        tableBody.innerHTML+=`<tr>
            <td>${e.time}<br><small>${e.date}</small></td>
            <td>${e.work}<br><small>${e.note||''}</small></td>
            <td>${e.qty}</td><td>${e.total}</td><td>${e.taken}</td><td>${e.loss}</td><td>${e.user}</td>
            <td class="noPrint"><button class="btn-del" onclick="del('${key}')">‚ùå</button></td>
        </tr>`;
    });
    cCount.innerText=c; cTotal.innerText=t; cTaken.innerText=k; cLoss.innerText=l;
}

function searchByDate(){
    if(!sDate.value) return alert("‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®");
    const d = sDate.value.split("-").reverse().join("/");
    db.ref("entries").orderByChild("date").equalTo(d).once("value",s=>{
        renderTable(s.val());
        showSection('dashboard');
    });
}

function del(key){
    if(confirm("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?")) db.ref("entries/"+key).remove();
}

function downloadExcel(){
    db.ref("entries").once("value",s=>{
        let csv="Date,Time,Work,Qty,Total,Cash,Loss,User,Note\n";
        Object.values(s.val()||{}).forEach(e=>{
            csv+=`${e.date},${e.time},${e.work},${e.qty},${e.total},${e.taken},${e.loss},${e.user},${e.note||''}\n`;
        });
        const a=document.createElement("a");
        a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
        a.download="report.csv"; a.click();
    });
}
</script>
</body>
</html>
